<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Design Token Inspector</title>

<style>
body {
  font-family: Inter, sans-serif;
  padding: 24px;
  background: #f9fafb;
}

h1 {
  margin-bottom: 24px;
}

.controls {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}

select, input {
  padding: 8px;
  font-size: 14px;
}
.token-stats {
  width: 100%;
  margin-bottom: 16px;
  font-size: 14px;
  display: flex;
  align-items: center;
}

.token-count {
  position: relative;
  font-weight: 500;
  cursor: default;
}

.token-count:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  top: 24px;
  left: 0;
  white-space: pre;
  background: #111827;
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 12px;
  line-height: 1.4;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 100;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #e5e7eb;
}

.token-name {
  font-family: monospace;
  font-size: 12px;
  margin-bottom: 8px;
  word-break: break-all;
}

.token-value {
  font-weight: 600;
  margin-bottom: 4px;
}

.alias {
  font-size: 12px;
  color: #6b7280;
}
</style>
</head>
<body>

<h1>Design Token Inspector</h1>

<div class="controls">
  <select id="platformSelect"></select>

  <select id="tierSelect">
  <option value="all">All tiers</option>
  <option value="core">Core</option>
  <option value="semantic">Semantic</option>
  <option value="component">Component</option>
</select>

  <input type="text" id="searchInput" placeholder="Search tokens..." />
</div>
<div class="token-stats">
  <span id="tokenCount" class="token-count"></span>
</div>

<div class="grid" id="tokenGrid"></div>

<script>
const grid = document.getElementById("tokenGrid");
const platformSelect = document.getElementById("platformSelect");
const tierSelect = document.getElementById("tierSelect");
const searchInput = document.getElementById("searchInput");
const tokenCountEl = document.getElementById("tokenCount");

let allTokens = {};

async function init() {
  const metadata = await fetch("../tokens/$metadata.json").then(r => r.json());

  const platforms = new Set();
  const tierMap = {};

  for (const entry of metadata.tokenSetOrder) {
    const [platform, tierFile] = entry.split("/");
    const tier = tierFile.replace("-web", "");

    platforms.add(platform);

    if (!tierMap[platform]) tierMap[platform] = [];
    tierMap[platform].push(tierFile);
  }

  platformSelect.innerHTML = "";
  platforms.forEach(p => {
    const option = document.createElement("option");
    option.value = p;
    option.textContent = p.charAt(0).toUpperCase() + p.slice(1);
    platformSelect.appendChild(option);
  });

  for (const platform of platforms) {
    allTokens[platform] = {};

    const entries = metadata.tokenSetOrder.filter(e => e.startsWith(platform));

    for (const entry of entries) {
      const res = await fetch(`../tokens/${entry}.json`);
      const json = await res.json();
      allTokens[platform][entry.split("/")[1]] = flattenTokens(json);
    }
  }

  render();
}

function flattenTokens(obj, prefix = "") {
  let result = {};

  for (const key in obj) {
    const value = obj[key];
    const path = prefix ? `${prefix}.${key}` : key;

    if (value && typeof value === "object" && "$value" in value) {
      result[path] = value;
    } else if (value && typeof value === "object") {
      Object.assign(result, flattenTokens(value, path));
    }
  }

  return result;
}

function render() {
  grid.innerHTML = "";

  const platform = platformSelect.value;
  const selectedTier = tierSelect.value;
  const search = searchInput.value.trim().toLowerCase();

  if (!platform) return;

  const tiers = allTokens[platform];

  let totalCount = 0;
  let tierCounts = {};

  for (const tierFile in tiers) {
    const tier = tierFile.replace("-web", "");

    if (selectedTier !== "all" && tier !== selectedTier) continue;

    const tokens = tiers[tierFile];

    if (!tierCounts[tier]) tierCounts[tier] = 0;

    for (const name in tokens) {
      if (search && !name.toLowerCase().includes(search)) continue;

      tierCounts[tier]++;
      totalCount++;

      const token = tokens[name];

      const card = document.createElement("div");
      card.className = "card";

      const valueDisplay =
        typeof token.$value === "object"
          ? JSON.stringify(token.$value, null, 2)
          : token.$value;

      card.innerHTML = `
        <div class="token-name">${name}</div>
        <div class="token-value">${valueDisplay}</div>
        ${
          typeof token.$value === "string" && token.$value.startsWith("{")
            ? `<div class="alias">Alias â†’ ${token.$value}</div>`
            : ""
        }
      `;

      grid.appendChild(card);
    }
  }

  // Update total text
  tokenCountEl.textContent = `Tokens (${totalCount})`;

  // Build tooltip
  const tooltipLines = Object.entries(tierCounts)
    .map(([tier, count]) => `${tier} (${count})`)
    .join("\n");

  tokenCountEl.setAttribute("data-tooltip", tooltipLines);
}

platformSelect.addEventListener("change", render);
tierSelect.addEventListener("change", render);
searchInput.addEventListener("input", render);

init();
</script>

</body>
</html>

